<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Schedule — Days & Slots</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    padding: 32px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #f3f4f6;
    color: #111827;
  }

  .container {
    max-width: 1120px;
    margin: auto;
    background: #ffffff;
    border-radius: 18px;
    padding: 24px 24px 28px;
    box-shadow: 0 20px 40px rgba(15, 23, 42, 0.12);
    border: 1px solid #e5e7eb;
  }

  /* STEPPER */
  .stepper {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    border-bottom: 1px solid #e5e7eb;
    padding-bottom: 10px;
  }
  .step {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border-radius: 999px;
    background: #f3f4f6;
    color: #6b7280;
    font-size: 13px;
  }
  .step-number {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #ffffff;
    border: 1px solid #d1d5db;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    font-weight: 600;
  }
  .step.active {
    background: #e0e7ff;
    color: #1d4ed8;
  }
  .step.active .step-number {
    background: #1d4ed8;
    border-color: #1d4ed8;
    color: white;
  }
  .step.completed {
    background: #dcfce7;
    color: #15803d;
  }
  .step.completed .step-number {
    background: #22c55e;
    border-color: #22c55e;
    color: white;
  }

  /* LAYOUT */
  .grid {
    display: grid;
    grid-template-columns: 1.1fr 1fr;
    gap: 20px;
  }
  @media (max-width: 900px) {
    .grid { grid-template-columns: 1fr; }
  }

  /* PANELS */
  .panel {
    background: linear-gradient(to bottom, #ffffff, #f9fafb);
    border: 1px solid #e5e7eb;
    padding: 14px 14px 16px;
    border-radius: 12px;
  }
  .panel h3 {
    margin: 0 0 6px;
    font-size: 15px;
  }
  .subtitle {
    margin: 0 0 14px;
    color: #6b7280;
    font-size: 13px;
  }

  /* DAY CHIPS */
  .days-label-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 12px;
    color: #6b7280;
  }

  .quick-links {
    display: flex;
    gap: 6px;
  }
  .quick-links button {
    padding: 3px 8px;
    border-radius: 999px;
    background: #e5e7eb;
    border: none;
    font-size: 11px;
    cursor: pointer;
  }

  .day-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 14px;
  }
  .chip {
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid #d1d5db;
    background: #f9fafb;
    font-size: 12px;
    cursor: pointer;
  }
  .chip.selected {
    background: #e0e7ff;
    color: #1d4ed8;
    border-color: #1d4ed8;
  }

  /* SLOT ROWS */
  .slot-rows {
    border: 1px dashed #d1d5db;
    background: #f9fafb;
    border-radius: 10px;
    padding: 8px;
    margin-bottom: 10px;
  }

  .slot-row {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 6px;
    align-items: end;
    margin-bottom: 6px;
  }

  .remove-row-btn {
    background: #fee2e2;
    color: #b91c1c;
    padding: 4px 7px;
    font-size: 11px;
    border-radius: 999px;
    border: none;
    cursor: pointer;
  }

  /* time picker */
  .time-field {
    display: flex;
    flex-direction: column;
    gap: 2px;
    font-size: 11px;
    position: relative; /* dropdown anchors here */
  }

  .time-input {
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    padding: 6px 8px;
    min-height: 30px;
    font-size: 12px;
    display: flex;
    justify-content: space-between;
    cursor: pointer;
  }

  .time-input.placeholder { color: #9ca3af; }
  .time-input-arrow { font-size: 10px; color: #9ca3af; }

  .time-dropdown {
    position: absolute;
    top: 36px;
    left: 0;
    right: 0;
    background: white;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
    max-height: 180px;
    overflow-y: auto;
    box-shadow: 0 10px 25px rgba(15,23,42,0.12);
    z-index: 200;
    display: none;
  }

  .time-option {
    padding: 6px 8px;
    cursor: pointer;
    border-radius: 6px;
  }
  .time-option:hover {
    background: #e0e7ff;
    color: #1d4ed8;
  }

  .add-slot-btn {
    border: 1px dashed #9ca3af;
    padding: 6px 10px;
    border-radius: 999px;
    cursor: pointer;
    font-size: 12px;
    background: transparent;
  }

  .primary-btn {
    background: #2563eb;
    border: none;
    padding: 7px 14px;
    border-radius: 999px;
    color: white;
    font-size: 12px;
    cursor: pointer;
  }
  .primary-btn:disabled {
    opacity: 0.4;
    cursor: default;
  }

  /* DAY CARDS */
  .day-cards {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  @media (max-width: 700px) {
    .day-cards { grid-template-columns: 1fr; }
  }

  .day-card {
    background: #f9fafb;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    padding: 10px;
  }
  .day-card-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
  }
  .inline-add-btn {
    border: 1px solid #d1d5db;
    padding: 4px 8px;
    border-radius: 999px;
    font-size: 11px;
    background: white;
    cursor: pointer;
  }

  .slot-list {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
    margin-bottom: 6px;
  }
  .slot-pill {
    background: #ffffff;
    border: 1px solid #d1d5db;
    padding: 3px 8px;
    border-radius: 999px;
    font-size: 11px;
    display: inline-flex;
    align-items: center;
    gap: 4px;
  }
  .slot-pill-conflict {
    border-color: #f97373;
    background: #fef2f2;
    color: #b91c1c;
  }
  .slot-pill-delete {
    border: none;
    background: transparent;
    font-size: 11px;
    cursor: pointer;
    color: #9ca3af;
  }
  .slot-pill-delete:hover {
    color: #b91c1c;
  }

  .inline-slot-row {
    border: 1px dashed #d1d5db;
    background: #f3f4f6;
    padding: 6px;
    margin-top: 6px;
    border-radius: 8px;
    display: none;
  }
  .inline-slot-row-inner {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 6px;
  }
  .inline-save-btn {
    background: #2563eb;
    color: white;
    border-radius: 999px;
    border: none;
    padding: 4px 8px;
    font-size: 11px;
    cursor: pointer;
  }

  .empty-text { font-size: 11px; color: #9ca3af; }

  .conflict-note {
    font-size: 11px;
    color: #b91c1c;
    margin-top: 2px;
  }
</style>
</head>

<body>
<div class="container">

  <!-- STEPPER -->
  <div class="stepper">
    <div class="step completed"><div class="step-number">1</div>Basics</div>
    <div class="step active"><div class="step-number">2</div>Days & slots</div>
    <div class="step"><div class="step-number">3</div>Review</div>
  </div>

  <!-- GRID -->
  <div class="grid">

    <!-- LEFT: CREATE SLOTS -->
    <section class="panel">
      <h3>Select days</h3>
      <p class="subtitle">These days will get the time slots you create below.</p>

      <div class="days-label-row">
        <span>Days in schedule</span>
        <div class="quick-links">
          <button data-quick="weekdays">Mon–Fri</button>
          <button data-quick="weekends">Sat–Sun</button>
          <button data-quick="all">All</button>
        </div>
      </div>

      <div id="dayChips" class="day-chips"></div>

      <div class="section-title" style="font-weight:600;">Slots for selected days</div>
      <p class="subtitle" style="margin-top:0;">Add one or more slots. They'll apply to all selected days.</p>

      <div id="slotRows" class="slot-rows"></div>
      <button id="addSlotBtn" class="add-slot-btn">+ Add slot</button>

      <div style="margin-top:12px;">
        <button id="applyToDaysBtn" class="primary-btn" disabled>
          Apply to selected days
        </button>
      </div>
    </section>

    <!-- RIGHT: DAY-BY-DAY -->
    <section class="panel">
      <h3>Your weekly schedule</h3>
      <p class="subtitle">Edit any day individually from here.</p>

      <div id="dayCards" class="day-cards"></div>
    </section>

  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const DAYS = ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
  const daySelection = new Set(["Mon","Tue","Wed","Thu","Fri"]);
  const daySlots = {}; DAYS.forEach(d => daySlots[d] = []);

  // Time options 06:00–22:00 every 30 mins
  const timeOptions = [];
  for (let h = 6; h <= 22; h++) {
    for (let m = 0; m < 60; m += 30) {
      timeOptions.push(`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`);
    }
  }

  const dayChipsEl = document.getElementById("dayChips");
  const slotRowsEl = document.getElementById("slotRows");
  const addSlotBtn = document.getElementById("addSlotBtn");
  const applyBtn = document.getElementById("applyToDaysBtn");
  const dayCardsEl = document.getElementById("dayCards");

  function sortSlots(arr) {
    arr.sort((a,b) => a.start.localeCompare(b.start) || a.end.localeCompare(b.end));
  }

  function renderDayChips() {
    dayChipsEl.innerHTML = "";
    DAYS.forEach(d => {
      const chip = document.createElement("button");
      chip.className = "chip" + (daySelection.has(d) ? " selected" : "");
      chip.textContent = d;
      chip.onclick = () => {
        daySelection.has(d) ? daySelection.delete(d) : daySelection.add(d);
        renderDayChips();
        updateApplyState();
      };
      dayChipsEl.appendChild(chip);
    });
  }

  function createTimeField(labelText) {
    const wrapper = document.createElement("div");
    wrapper.className = "time-field";

    const label = document.createElement("div");
    label.className = "time-label";
    label.textContent = labelText;
    wrapper.appendChild(label);

    const input = document.createElement("div");
    input.className = "time-input placeholder";
    input.textContent = "Select time";
    const arrow = document.createElement("span");
    arrow.className = "time-input-arrow";
    arrow.textContent = "▾";
    input.appendChild(arrow);
    wrapper.appendChild(input);

    const dropdown = document.createElement("div");
    dropdown.className = "time-dropdown";
    timeOptions.forEach(t => {
      const opt = document.createElement("div");
      opt.className = "time-option";
      opt.textContent = t;
      opt.onclick = () => {
        input.textContent = t;
        input.appendChild(arrow);
        input.classList.remove("placeholder");
        input.dataset.value = t;
        dropdown.style.display = "none";
      };
      dropdown.appendChild(opt);
    });
    wrapper.appendChild(dropdown);

    input.onclick = (e) => {
      e.stopPropagation();
      dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
    };

    return { wrapper, input };
  }

  function addSlotRow() {
    const row = document.createElement("div");
    row.className = "slot-row";

    const start = createTimeField("Start time");
    const end = createTimeField("End time");

    row.appendChild(start.wrapper);
    row.appendChild(end.wrapper);

    const remove = document.createElement("button");
    remove.className = "remove-row-btn";
    remove.textContent = "×";
    remove.onclick = () => {
      row.remove();
      updateApplyState();
      if (slotRowsEl.children.length === 0) addSlotRow();
    };
    row.appendChild(remove);

    slotRowsEl.appendChild(row);
    updateApplyState();
  }

  function updateApplyState() {
    const hasRows = slotRowsEl.querySelectorAll(".slot-row").length > 0;
    const hasDays = daySelection.size > 0;
    applyBtn.disabled = !(hasRows && hasDays);
  }

  function renderDayCards() {
    dayCardsEl.innerHTML = "";
    DAYS.forEach(day => {
      const card = document.createElement("div");
      card.className = "day-card";

      const header = document.createElement("div");
      header.className = "day-card-header";

      const name = document.createElement("div");
      name.className = "day-name";
      name.textContent = day;

      const addBtn = document.createElement("button");
      addBtn.className = "inline-add-btn";
      addBtn.textContent = "Add slot";

      header.appendChild(name);
      header.appendChild(addBtn);
      card.appendChild(header);

      const list = document.createElement("div");
      list.className = "slot-list";

      // detect conflicts (duplicate slots)
      const counts = {};
      daySlots[day].forEach(s => {
        const k = `${s.start}-${s.end}`;
        counts[k] = (counts[k] || 0) + 1;
      });
      let hasConflict = false;

      if (daySlots[day].length === 0) {
        const empty = document.createElement("div");
        empty.className = "empty-text";
        empty.textContent = "No slots yet.";
        list.appendChild(empty);
      } else {
        daySlots[day].forEach((s, index) => {
          const key = `${s.start}-${s.end}`;
          const conflict = counts[key] > 1;
          if (conflict) hasConflict = true;

          const pill = document.createElement("span");
          pill.className = "slot-pill" + (conflict ? " slot-pill-conflict" : "");
          pill.textContent = `${s.start} – ${s.end}`;

          const del = document.createElement("button");
          del.className = "slot-pill-delete";
          del.textContent = "×";
          del.title = "Remove this slot";
          del.onclick = () => {
            daySlots[day].splice(index, 1);
            renderDayCards();
          };

          pill.appendChild(del);
          list.appendChild(pill);
        });
      }

      card.appendChild(list);

      if (hasConflict) {
        const note = document.createElement("div");
        note.className = "conflict-note";
        note.textContent = "Some slots are duplicated on this day.";
        card.appendChild(note);
      }

      const inline = document.createElement("div");
      inline.className = "inline-slot-row";
      const inner = document.createElement("div");
      inner.className = "inline-slot-row-inner";

      const s = createTimeField("Start");
      const e = createTimeField("End");

      inner.appendChild(s.wrapper);
      inner.appendChild(e.wrapper);

      const save = document.createElement("button");
      save.className = "inline-save-btn";
      save.textContent = "Add";
      save.onclick = () => {
        const st = s.input.dataset.value;
        const en = e.input.dataset.value;
        if (!st || !en) return;
        daySlots[day].push({ start: st, end: en });
        sortSlots(daySlots[day]);
        renderDayCards();
      };

      inner.appendChild(save);
      inline.appendChild(inner);
      card.appendChild(inline);

      addBtn.onclick = () => {
        inline.style.display = inline.style.display === "block" ? "none" : "block";
      };

      dayCardsEl.appendChild(card);
    });
  }

  applyBtn.onclick = () => {
    const rows = slotRowsEl.querySelectorAll(".slot-row");
    const newSlots = [];

    rows.forEach(row => {
      const fields = row.querySelectorAll(".time-input");
      const start = fields[0].dataset.value;
      const end = fields[1].dataset.value;
      if (start && end) newSlots.push({ start, end });
    });

    daySelection.forEach(day => {
      newSlots.forEach(s => daySlots[day].push({ ...s }));
      sortSlots(daySlots[day]);
    });

    slotRowsEl.innerHTML = "";
    addSlotRow();
    updateApplyState();
    renderDayCards();
  };

  // Quick selection buttons
  document.querySelectorAll("[data-quick]").forEach(btn => {
    btn.onclick = () => {
      daySelection.clear();
      const type = btn.dataset.quick;
      if (type === "weekdays") ["Mon","Tue","Wed","Thu","Fri"].forEach(d => daySelection.add(d));
      if (type === "weekends") ["Sat","Sun"].forEach(d => daySelection.add(d));
      if (type === "all") DAYS.forEach(d => daySelection.add(d));
      renderDayChips();
      updateApplyState();
    };
  });

  // Close dropdowns on outside click
  document.addEventListener("click", () => {
    document.querySelectorAll(".time-dropdown").forEach(dd => dd.style.display = "none");
  });

  // Wire Add slot button (this was missing earlier)
  addSlotBtn.onclick = () => { addSlotRow(); };

  // Init
  renderDayChips();
  renderDayCards();
  addSlotRow();
});
</script>

</body>
</html>